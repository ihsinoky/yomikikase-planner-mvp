# AGENTS.md – 開発ガイドライン

このドキュメントは、絵本読み聞かせ活動支援システムの開発を行うエンジニア向けのガイドラインです。テスト駆動開発（TDD）を採用し、TypeScript や Web 開発の初学者でも取り組みやすいように手順や記録方法を解説します。また、レビューができるようにアーキテクチャ決定記録（ADR）の運用方法や、その他の開発ベストプラクティスもまとめています。

## 1. 開発プロセス – テスト駆動開発 (TDD)

### 1.1 TDD の基本原則
- **Red → Green → Refactor**  
  1. まず失敗するテストを書く（Red）  
  2. テストが通る最小限の実装を書く（Green）  
  3. 実装やテストを改善する（Refactor）

### 1.2 TypeScript × TDD のポイント
- strict mode を必ず ON  
- 依存関係は小さく  
- 副作用を減らし、関数型スタイルを採用  
- モックは必要最小限に

## 2. ADR（Architecture Decision Record）

### 2.1 ADR を書く目的
- 後から判断理由を追跡可能にする  
- 初学者でも「なぜその設計にしたか」を理解しやすくする  
- レビューで議論しやすくする  

### 2.2 ADR テンプレート
```
# ADR-000 タイトル
## コンテキスト
## 決定
## 採用理由
## 他の選択肢
## トレードオフ
## ステータス
```

## 3. TypeScript ベストプラクティス
- strictNullChecks など型安全を最大化する設定を有効化  
- 関数は純粋に  
- any を避ける  
- 型ガードを活用する  
- DTO 型と内部ロジック型を分離する  

## 4. Web フロントエンドのベストプラクティス
- Alpine.js を使うことで UI の複雑性を抑える  
- DOM 操作は極小にし、状態は x-data に集約  
- fetch API のエラー処理を共通化  

## 5. バックエンド（Hono）のベストプラクティス
- ルーティングは機能ごとに分割  
- バリデーションは必ずサーバ側でも実施  
- DB アクセス層を疎結合に設計  

## 6. PR

- PR はただのコード差分ではなく、“なぜこう実装するのか” を未来の開発者に説明する技術ドキュメントとして扱う。
- TypeScript / Hono / Alpine.js / Web API / DB の基礎を「この PR を読めば理解できる」レベルで記述する。
- 初学者がレビューできるよう、専門用語はかならず説明文つきにする。
- 以下にテンプレートを使用する

```Markdown
# 📝 PR タイトル（要点を一言で）

## 1. このPRで追加した機能・変更点
- 何を実現したかを初心者でも理解できる言葉で説明する
- UIの変化がある場合はスクリーンショットを添付する

---

## 2. TypeScript 基礎解説（このPRに関連する概念）

### ▶ 使った TS の文法・型の説明
例：
- `interface` でデータ構造を表現している理由  
- `type` との違い  
- `undefined` を排除するための `strictNullChecks`  
- `as const` や `readonly` の使いどころ  

### ▶ なぜこの書き方を採用したのか
例：
- 「型安全にすることで API 返却値との不整合を検知できる」
- 「利用者が増えても型の変更が伝播しやすい構造にするため」

---

## 3. Hono 基礎解説（API 開発の理解を助ける）

### ▶ この PR に関係する Hono の要素
例：
- `app.get('/profiles', ...)` のルーティング構造  
- `c.req.json()` の使い方  
- ミドルウェアの役割  

### ▶ 選択したアーキテクチャの理由
例：
- 「Hono は Web 標準 API ベースなので学習コストが低い」
- 「小さな関数に分けることでテストしやすくなる」

---

## 4. Alpine.js 基礎解説（フロントの動き）

### ▶ 使った Alpine.js の構文
例：
- `x-data` の役割（状態管理）
- `x-model` でのフォームバインディング
- `x-for` によるリスト描画
- `x-show` / `x-if` の違い

### ▶ なぜ Alpine.js を使うのか
例：
- 「React ほど重い仕組みが不要なため」
- 「HTML そのままの構造で状態を管理でき、初心者に優しい」

---

## 5. TDD（テスト駆動開発）の振り返り

### ▶ 最初に書いたテスト（Red）
- どんな失敗を想定したか

### ▶ それを通すために書いた実装（Green）
- 必要最小限のコードの説明

### ▶ リファクタリングで改善した点（Refactor）
- 命名、責務分割、型改善など

---

## 6. 考慮したトレードオフと ADR へのリンク
- この PR の決定は長期的に正しいか？
- 他の選択肢は何だったか？
- 必要なら別途 ADR を作成しリンクする

---

## 7. 動作確認手順
（誰でも同じ手順で再現できること）

---

## 8. 残課題・今後の改善点
```

## 7. 作業ログ / ADR / TDD の統合運用
- 新しい機能を作るときは以下の順に進める  
  1. 最初に ADR を書く（必要なら）  
  2. 次にテストを書く  
  3. 実装を書く  
  4. 実装後に振り返りメモを残す  
  5. PR に ADR とテストを添付する  

